# 第11章：目标设定和监控模式

本章实现了基于PocketFlow的目标设定和监控模式，该模式通过迭代式代码生成、评估和改进来满足用户定义的目标。

## 模式概述

目标设定和监控模式是一种AI编程模式，它包含以下步骤：

1. **目标设定**：接收和解析用户的目标
2. **代码生成**：根据目标生成初始代码
3. **代码评估**：评估代码是否满足目标
4. **代码改进**：根据评估反馈改进代码
5. **循环迭代**：重复步骤3-4直到目标达成或达到最大迭代次数

## 文件结构

```
chapter11_目标设定和监控/
├── main.py                     # 主程序入口
├── goal_monitoring_flow.py     # 主流程文件
├── goal_setting_node.py        # 目标设定节点
├── code_generation_node.py     # 代码生成节点
├── code_evaluation_node.py     # 代码评估节点
├── code_improvement_node.py    # 代码改进节点
├── output/                     # 输出目录（运行时创建）
│   ├── generated_code_N.py     # 生成的代码文件
│   └── README.md               # 生成代码的说明
└── README.md                   # 本文档
```

## 节点说明

### GoalSettingNode（目标设定节点）
- **功能**：接收和解析用户的目标
- **输入**：用户用例和目标列表
- **输出**：存储到共享状态中

### CodeGenerationNode（代码生成节点）
- **功能**：根据目标生成初始代码
- **输入**：用例、目标和之前的代码（如果有）
- **输出**：生成的代码

### CodeEvaluationNode（代码评估节点）
- **功能**：评估代码是否满足目标
- **输入**：当前代码和目标
- **输出**：反馈和目标达成状态

### CodeImprovementNode（代码改进节点）
- **功能**：根据评估反馈改进代码
- **输入**：之前的代码、目标和反馈
- **输出**：改进后的代码

### SaveCodeNode（保存代码节点）
- **功能**：保存最终代码到文件
- **输入**：最终代码、用例和目标
- **输出**：保存的文件路径

## 运行方法

1. 确保已安装必要的依赖：
   ```bash
   pip install -r requirements.txt
   ```

2. 运行主程序：
   ```bash
   cd chapter11_目标设定和监控
   python main.py
   ```

3. 查看生成的代码：
   ```bash
   cat output/generated_code_N.py
   cat output/README.md
   ```

## 示例输出

程序将显示以下内容：
- 用例和目标
- 每次迭代生成的代码
- 代码评估反馈
- 最终代码保存位置

## 自定义用例

要使用自定义用例，修改`main.py`文件中的`use_case`和`goals`变量：

```python
# 自定义用例
use_case = "你的用例描述"

# 自定义目标
goals = [
    "目标1",
    "目标2",
    # ... 更多目标
]
```

## 参数调整

可以通过修改`main.py`中的`max_iterations`变量来调整最大迭代次数：

```python
# 设置最大迭代次数
max_iterations = 5  # 默认为5
```

## 依赖项

- Python 3.8+
- PocketFlow
- OpenAI（用于LLM调用）
- 其他依赖项见requirements.txt

## 注意事项

1. 确保OpenAI API密钥已正确配置
2. 生成代码的输出目录会在运行时自动创建
3. 每次运行都会覆盖之前生成的文件
4. 如果目标未达成且达到最大迭代次数，程序会保存最后一次生成的代码

## 扩展功能

可以通过以下方式扩展此模式：

1. 添加更多评估指标
2. 实现代码测试功能
3. 添加代码格式化步骤
4. 支持多种编程语言
5. 添加代码文档生成功能